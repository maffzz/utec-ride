<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mis reservas - UtecRide</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="reservas-page">
  <header class="topbar">
    <div class="topbar-left">
      <div class="logo-circle">UR</div>
      <div class="brand-text">
        <h1>UtecRide</h1>
        <p>Carpooling entre estudiantes UTEC</p>
      </div>
    </div>
    <div class="topbar-right">
      <a href="index.html" class="btn btn-ghost">Buscar rides</a>
      <a href="crear-viaje.html" class="btn btn-primary">Crear viaje</a>
    </div>
  </header>

  <main class="page-main reservas-main">
    <section class="search-panel">
      <h2>Mis reservas</h2>
      <p class="subtitle">Aquí verás tus próximos viajes como pasajero.</p>

      <div class="helper-list" id="reservas-empty">
        <p>No tienes reservas activas por ahora.</p>
        <p>Puedes <a href="index.html">buscar un ride</a> o <a href="crear-viaje.html">crear uno nuevo</a>.</p>
      </div>
    </section>

    <section class="layout layout-reservas">
      <section class="results-panel">
      <header class="results-header">
        <div>
          <div class="reservas-header-inline">
            <div class="reservas-icon-circle"></div>
            <div>
              <h2>Historial reciente</h2>
              <p id="results-count" class="subtitle">Cargando reservas...</p>
            </div>
          </div>
        </div>
      </header>
      <div class="rides-list" id="reservas-list">
        <p class="ride-empty">Esta sección es solo de muestra por ahora.</p>
      </div>
      </section>
    </section>
  </main>
  <script>
    (function () {
      const listEl = document.getElementById('reservas-list');
      const emptyEl = document.getElementById('reservas-empty');
      const countEl = document.getElementById('results-count');
      const body = document.body;

      let reservas = [];
      try {
        const raw = localStorage.getItem('mis_reservas');
        reservas = raw ? JSON.parse(raw) : [];
      } catch (e) {
        reservas = [];
      }

      listEl.innerHTML = '';

      if (!reservas.length) {
        countEl.textContent = '0 reservas';
        emptyEl.style.display = 'block';
        if (body && body.classList) body.classList.add('reservas-empty');

        const wrapper = document.createElement('div');
        wrapper.className = 'reservas-empty-card';

        const title = document.createElement('h3');
        title.textContent = 'No tienes reservas aún';

        const text = document.createElement('p');
        text.textContent = 'Cuando te unas a un ride, aparecerá aquí.';

        const actions = document.createElement('div');
        actions.className = 'reservas-empty-actions';

        const btnBuscar = document.createElement('a');
        btnBuscar.href = 'index.html';
        btnBuscar.className = 'btn btn-secondary';
        btnBuscar.textContent = 'Buscar un ride';

        const btnCrear = document.createElement('a');
        btnCrear.href = 'crear-viaje.html';
        btnCrear.className = 'btn btn-primary';
        btnCrear.textContent = 'Crear viaje';

        actions.appendChild(btnBuscar);
        actions.appendChild(btnCrear);

        wrapper.appendChild(title);
        wrapper.appendChild(text);
        wrapper.appendChild(actions);

        listEl.appendChild(wrapper);
        return;
      }

      emptyEl.style.display = 'none';
      if (body && body.classList) body.classList.remove('reservas-empty');
      countEl.textContent = `${reservas.length} reserva${
        reservas.length !== 1 ? 's' : ''
      }`;

      reservas.forEach(function (ride, index) {
        const card = document.createElement('article');
        card.className = 'ride-card';

        const main = document.createElement('div');
        main.className = 'ride-main';

        const line = document.createElement('div');
        line.className = 'ride-line';

        const time = document.createElement('span');
        time.className = 'ride-time';
        time.textContent = ride.time;

        const route = document.createElement('span');
        route.className = 'ride-route';
        route.textContent = `${ride.from} → ${ride.to}`;

        line.appendChild(time);
        line.appendChild(route);

        const driver = document.createElement('p');
        driver.className = 'ride-driver';
        driver.innerHTML = 'Conductor: <strong>' + (ride.driver || 'Conductor') + '</strong>';

        const meta = document.createElement('p');
        meta.className = 'ride-meta';
        meta.textContent =
          (ride.freeSeats || 0) +
          ' asientos libres · Aporte S/ ' +
          (ride.price || 0);

        main.appendChild(line);
        main.appendChild(driver);
        main.appendChild(meta);

        const side = document.createElement('div');
        side.className = 'ride-side';

        const status = document.createElement('span');
        status.className = 'ride-status-pill ride-status-open';
        status.textContent = 'Reservado';

        const when = document.createElement('p');
        when.className = 'ride-meta';
        when.textContent = 'Te uniste el ' + (ride.joinedAt || '').slice(0, 10);

        const cancelBtn = document.createElement('button');
        cancelBtn.className = 'btn btn-secondary';
        cancelBtn.textContent = 'Cancelar';
        cancelBtn.addEventListener('click', function () {
          const ok = confirm(
            '¿Seguro que quieres cancelar esta reserva?'
          );
          if (!ok) return;

          const rawNow = localStorage.getItem('mis_reservas');
          const current = rawNow ? JSON.parse(rawNow) : [];
          current.splice(index, 1);
          localStorage.setItem('mis_reservas', JSON.stringify(current));

          card.remove();

          if (!current.length) {
            countEl.textContent = '0 reservas';
            emptyEl.style.display = 'block';
          } else {
            countEl.textContent = `${current.length} reserva${
              current.length !== 1 ? 's' : ''
            }`;
          }
        });

        side.appendChild(status);
        side.appendChild(when);
        side.appendChild(cancelBtn);

        card.appendChild(main);
        card.appendChild(side);

        listEl.appendChild(card);
      });
    })();
  </script>
</body>
</html>
